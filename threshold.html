<!DOCTYPE html>
<html lang="en">

<head>
    <title>Home</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>

<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <ul class="nav navbar-nav">
                <li><a href="index.html">Home</a></li>
                <li><a href="random.html">Random Guess</a></li>
                <li class="active"><a href="threshold.html">Threshold Value</a></li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div col-md-12>
            <label for="first_name">First Name:</label>
            <input type="text" class="form-control" id="first_name" placeholder="First Name">
        </div>

        <div class="col-md-4">
            Is the classmate able to eat garlic?
            <div class="radio">
                <label><input type="radio" name="garlic" id="garlic_yes" value="Yes" >Yes</label>
            </div>
            <div class="radio">
                <label><input type="radio" name="garlic" id="garlic_no" value="No" checked>No</label>
            </div>
        </div>
        <div class="col-md-4">
            Have you seen the classmate's shadow?
            <div class="radio">
                <label><input type="radio" name="shadow" id="shadow_yes" value="Yes">Yes</label>
            </div>
            <div class="radio">
                <label><input type="radio" name="shadow" id="shadow_no" value="No" checked>No</label>
            </div>
        </div>
        <div class="col-md-4">
            Is the skin color of the classmate pale?
            <div class="radio">
                <label><input type="radio" name="complexion" id="pale_yes" value="Yes">Yes</label>
            </div>
            <div class="radio">
                <label><input type="radio" name="complexion" id="pale_no" value="No" checked>No</label>
            </div>
        </div>

        <div class="col-md-12">
            <button class="btn btn-primary" onclick="add_row()">Add Data</button>
            <button class="btn btn-primary" onclick="delete_row()">Delete Last Row</button>
        </div>

        <!-- create a table using data from example 24 -->
        <div class="col-md-6">
            <table class="table" id="threshold_table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Garlic</th>
                        <th>Shadow</th>
                        <th>Pale skin</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>John</td>
                        <td>No</td>
                        <td>No</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>Lee</td>
                        <td>Yes</td>
                        <td>No</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>Emma</td>
                        <td>Yes</td>
                        <td>No</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>Ava</td>
                        <td>Yes</td>
                        <td>Yes</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>Alex</td>
                        <td>No</td>
                        <td>No</td>
                        <td>No</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-md-6">
            <!-- generate a pie chart based on the threshold value entered by the user-->
            <div id="pie_div"></div>
            <button class="btn btn-primary" onclick="refresh()">Refresh</button>
        </div>
    </div>
    <script type="text/javascript">
        var table = document.getElementById('threshold_table');
        // get values from table as key value pairs
        //https://stackoverflow.com/questions/2968253/get-values-from-table-as-key-value-pairs-with-jquery
        var student_data = $('#threshold_table tbody').children().map(function() {
            var children = $(this).children();

            return {
                'name': children.eq(0).text(),
                'shadow': children.eq(1).text(),
                'garlic': children.eq(2).text(),
                'complextion': children.eq(3).text()
            };
        }).get();
        console.log(student_data);
        // Load the visualization API and the corechart package
        google.charts.load('current', {
            'packages': ['corechart']
        });
        // set a callback to run when visulization api is running
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = new google.visualization.DataTable();
            classmate_data_processing(data);

            var options = {
                'title': 'How many vampires in the class?',
                'width': 400,
                'height': 300
            };

            var chart = new google.visualization.PieChart(document.getElementById('pie_div'));
            chart.draw(data, options);
        }

        // model of MVC
        function classmate_data_processing(result_data) {
            var num_human = 0;
            var num_vampire = 0;
            for (i = 0; i < student_data.length; i++) {
                if ((student_data[i]['shadow'] == 'No' && student_data[i]['garlic'] == 'No') ||
                    (student_data[i]['complexion'] == 'Yes' && student_data[i]['shadow'] == 'No')) {
                    num_vampire++;
                } else {
                    num_human++;
                }
            }

            // create the data table
            result_data.addColumn('string', 'Element');
            result_data.addColumn('number', 'Count');
            result_data.addRows([
                ['Human', num_human],
                ['Vampire', num_vampire]
            ]);
        }
        //console.log(row_count);
        //add user input to the last row of the current table
        function add_row() {
            var row_count = table.rows.length;
            var row = table.insertRow(row_count);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);

            // add content to the new cells
            //https://www.geeksforgeeks.org/how-to-get-value-of-selected-radio-button-using-javascript/
            cell1.innerHTML = document.getElementById('first_name').value;
            if (document.getElementById('garlic_yes').checked) {
                cell2.innerHTML = 'Yes';
            } else {
                cell2.innerHTML = 'No';
            }
            if (document.getElementById('shadow_yes').checked) {
                cell3.innerHTML = 'Yes';
            } else {
                cell3.innerHTML = 'No';
            }
            if (document.getElementById('pale_yes').checked) {
                cell4.innerHTML = 'Yes';
            } else {
                cell4.innerHTML = 'No';
            }
        }

        function delete_row() {
            var row_count = table.rows.length;
            table.deleteRow(row_count - 1);
        }
    </script>
</body>

</html>